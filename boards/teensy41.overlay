/*
 * NV-Center Controller - Teensy 4.1 Device Tree Overlay
 *
 * SPDX-License-Identifier: Apache-2.0
 *
 * Minimal overlay for NV-center pulse sequencer.
 * GPT and other peripherals are accessed via direct register
 * manipulation in the firmware for deterministic timing.
 */

/ {
    chosen {
        zephyr,console = &cdc_acm_uart0;
        zephyr,shell-uart = &cdc_acm_uart0;
    };

    /* NV-Center Controller pin definitions */
    nv_controller: nv-controller {
        compatible = "gpio-leds";
        status = "okay";

        /*
         * TTL Channel GPIO assignments (Teensy 4.1 pinout)
         *
         * Teensy Pin -> i.MX RT1062 GPIO
         * Pin 2  -> GPIO4.IO04 (GPIO_EMC_04)
         * Pin 3  -> GPIO4.IO05 (GPIO_EMC_05)
         * Pin 4  -> GPIO4.IO06 (GPIO_EMC_06)
         * Pin 5  -> GPIO4.IO08 (GPIO_EMC_08)
         * Pin 6  -> GPIO2.IO10 (GPIO_B0_10)
         * Pin 7  -> GPIO2.IO17 (GPIO_B1_01)
         * Pin 8  -> GPIO2.IO16 (GPIO_B1_00)
         * Pin 9  -> GPIO2.IO11 (GPIO_B0_11)
         */

        mw_i: mw-i {
            gpios = <&gpio4 4 GPIO_ACTIVE_HIGH>;
            label = "MW_I";
        };

        mw_q: mw-q {
            gpios = <&gpio4 5 GPIO_ACTIVE_HIGH>;
            label = "MW_Q";
        };

        laser: laser {
            gpios = <&gpio4 6 GPIO_ACTIVE_HIGH>;
            label = "LASER";
        };

        master: master {
            gpios = <&gpio4 8 GPIO_ACTIVE_HIGH>;
            label = "MASTER";
        };

        trig_out: trig-out {
            gpios = <&gpio2 10 GPIO_ACTIVE_HIGH>;
            label = "TRIG_OUT";
        };

        aux_0: aux-0 {
            gpios = <&gpio2 17 GPIO_ACTIVE_HIGH>;
            label = "AUX_0";
        };

        aux_1: aux-1 {
            gpios = <&gpio2 16 GPIO_ACTIVE_HIGH>;
            label = "AUX_1";
        };

        aux_2: aux-2 {
            gpios = <&gpio2 11 GPIO_ACTIVE_HIGH>;
            label = "AUX_2";
        };
    };

    /* Trigger input pin */
    nv_trigger_in: nv-trigger-in {
        compatible = "gpio-keys";
        status = "okay";

        trig_in: trig-in {
            gpios = <&gpio2 18 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>;
            label = "TRIG_IN";
        };
    };
};

/* USB CDC ACM for host communication */
&zephyr_udc0 {
    cdc_acm_uart0: cdc_acm_uart0 {
        compatible = "zephyr,cdc-acm-uart";
    };
};

/* Enable required GPIO ports */
&gpio1 {
    status = "okay";
};

&gpio2 {
    status = "okay";
};

&gpio4 {
    status = "okay";
};
